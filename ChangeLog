1998-09-23 15:25  Ulrich Drepper  <drepper@cygnus.com>

	* libio/stdio.h: Define __need_getopt and include getopt.h to define
	getopt stuff.
	* posix/unistd.h: Likewise.
	* stdio/stdio.h: Likewise.
	* posix/getopt.h: Remove _GNU_SOURCE use.  If __need_getopt is defined
	define only getopt and the variables.

1998-09-23  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* scripts/test-installation.pl (installation_problem): Don't link
	the test program against libdb1.

1998-09-23 13:52  Ulrich Drepper  <drepper@cygnus.com>

	* Makeconfig (all-subdirs): Add db.
	* Versions.def: Add definition for libdb1.
	* shlib-versions: Add definitions for libdb1.
	* db/Makefile (extra-libs): Replace by libdb1.
	(libdb-routines): Rename to libdb1-routines.
	(headers): Rename to db1-headers.
	(distribute): Add $(db1-headers).
	(install-others): Define to install symlink libdb.so.NN and the
	$(db1-headers).
	(CPPFLAGS): Add -DUSE_LIBDB1
	Remove rules to build makedb.
	* db/Versions: Rename libdb to libdb1.
	* include/db.h: If USE_LIBDB1 is defined include db/db.h.
	* db/makedb.c: Removed.

	* scripts/versions.awk: Recognize digits in library names.

	* db/btree/bt_open.c: Fix compiler warnings.
	* db/btree/bt_put.c: Likewise.
	* db/btree/bt_split.c: Likewise.
	* db/hash/hash.c: Likewise.
	* db/hash/hash_bigkey.c: Likewise.
	* db/recno/rec_close.c: Likewise.

	* Makefile: Add localedata/% goal.

1998-09-22 19:58 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* posix/execvp.c: Don't give up searching the PATH if execve
	returns ENOTDIR.

1998-09-22 12:53  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/unix/sysv/linux/init-first.c (init): Don't call setfpucw only
	if _dl_fpu_control_set is set.
	* sysdeps/generic/dl-sysdep.c: Don't set _dl_fpu_control_set.
	* elf/rtld.c: Don't define _dl_fpu_control_set.
	* elf/Versions: Remove _dl_fpu_control_set.

1998-09-22 11:51  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/unix/sysv/linux/alpha/bits/sigaction.h (SA_ONSTACK): Define.
	* sysdeps/unix/sysv/linux/sparc/bits/sigaction.h: Likewise.
	* sysdeps/unix/sysv/linux/mips/bits/sigaction.h: Likewise.
	Correct values of other SA_* macros according to kernel headers.

1998-09-22  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/dl-load.c (_dl_init_paths): Avoid warning about unused
	variable l.
	* elf/dl-error.c (_dl_catch_error): Avoid warning about clobbering
	old.

1998-09-21  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/ldsodefs.h: Fix typo in comment.

1998-09-21  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* libio/genops.c (_IO_default_pbackfail): Add cast to unsigned
	char when comparing buffer contents with putback character.

1998-09-21  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/Makefile (dl-routines, elide-routines.os, rtld-routines):
	Undo last change.
	* elf/Versions: Undo last change.  Export _dl_fpu_control and
	_dl_fpu_control_set.
	* elf/rtld.c (_dl_fpu_control, _dl_fpu_control_set): New
	variables.  Include <fpu_control.h>.
	* sysdeps/generic/dl-sysdep.c: Store AT_FPUCW value in
	_dl_fpu_control instead of __fpu_control, set _dl_fpu_control_set
	to indicate that is was seen.
	* sysdeps/unix/sysv/linux/init-first.c: Omit call to __setfpucw
	only if _dl_fpu_control was set and is equal to desired value.
	* math/Makefile (aux): Undo last change.
	* math/Versions: Export __fpu_control with version GLIBC_2.0.

1998-09-21  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/m68k/dl-machine.h (elf_machine_lazy_rel): Slightly
	optimized.

1998-09-21 10:00  Ulrich Drepper  <drepper@cygnus.com>

	* string/bits/string2.h: Add mempcpy optimization.
	* sysdeps/generic/mempcpy.c: Undefined __mempcpy.
	* intl/localealias.c: Define mempcpy only if not already defined.

	* sysdeps/i386/i486/bits/string.h: Define ffsl only if not already
	defined.

1998-09-20 10:48 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* csu/abi-note.S: Emit the note directly instead of defining
	a preprocessor macro that's only used once.  Don't include sysdep.h.
	* abi-tags: Generalize Solaris entry.

1998-09-18  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/bsd/getpt.c (__libc_ptyname1, __libc_ptyname2):
	Change to array to avoid runtime relocation.
	* sysdeps/unix/sysv/linux/ptsname.c: Update declarations.

1998-09-21 12:22  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* malloc/Makefile ($(objpfx)libmcheck.a): Fix use of $(LN_S).
	* math/Makefile ($(objpfx)libieee.a): Likewise.

1998-09-21  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/generic/getpt.c: Fix order of argument to weak_alias.
	Patch by John Tobey <jtobey@banta-im.com>.

1998-09-20  Ulrich Drepper  <drepper@cygnus.com>

	* login/Makefile (distribute): Remove pty-internal.h, add
	pty-private.h.

	* stdlib/tst-strtol.c: Add more checks.
	Patch by Zack Weinberg <zack@rabi.columbia.edu>.

1998-09-20 09:37  Ulrich Drepper  <drepper@cygnus.com>

	* elf/Versions [GLIBC_2.1] (libc): Add __fpu_control.
	* elf/elf.h: Add AT_FPUCW.
	* elf/Makefile (dl-routines): Add fpu_control.
	(elide-routines.os): Add fpu_control.
	(rtld-routines): Add fpu_control.
	* math/Makefile (aux): Remove fpu_control.
	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Handle AT_FPUCW.
	(_dl_show_auxv): Likewise.
	* sysdeps/unix/sysv/linux/init-first.c (init): Use __setfpucw only
	if different from OS default.

	* stdio-common/tstscanf.c: Add test case for (nil).

1998-09-18 17:41  Ulrich Drepper  <drepper@cygnus.com>

	* libio/fileops.c (_IO_new_file_underflow): Before allocating
	buffer make sure the pushback buffer is destroyed.
	(_IO_new_file_seekoff): Likewise.
	If mode==0 quit early with the result.
	Clear OEF flag after successful fseek.
	* libio/libio.h (_IO_FILE_complete): Add _IO_save_ptr.
	* libio/ftello.c (ftello): Add offset from original buffer if
	stream has pushed back characters.
	* libio/ftello64.c (ftello64): Likewise.
	* libio/iofgetpos.c (_IO_fgetpos): Likewise.
	* libio/iofgetpos64.c (_IO_fgetpos64): Likewise.
	* libio/ioftell.c (_IO_ftell): Likewise.
	* libio/genops.c (_IO_switch_to_main_get_area): Swap _IO_read_ptr
	and _IO_save_ptr.
	(_IO_switch_to_backup_area): Save _IO_read_ptr in _IO_save_ptr.
	(_IO_default_pbackfail): Only stored push back character in original
	buffer if it is the same as the one in the file at this position.
	* libio/iofclose.c: Free backup buffer if one is available.
	* libio/ioseekoff.c (_IO_seekoff): Only remove pushback buffer if
	mode!=0.

	* strdlib/strtol.c (strtol): Handle 0x... string for base!=0 correctly.

	* time/strftime.c [_LIBC] (ampm): Use tp->tm_hour not hour12.

	* stdio-common/vfscanf.c: Fix reading (nil) for %p.

1998-09-18  Mark Kettenis  <kettenis@phys.uva.nl>

	* login/programs/pt_chown.c (more_help): Correct message that
	describes the purpose of the program.

	* login/openpty.c: Do not include pty-private.h.
	(pts_name): New function.  Return name of slave pseudo terminal in
	an allocated buffer if necessary.
	(openpty): Use pts_name to get name of the slave end of the pseudo
	terminal pair.

	* sysdeps/unix/grantpt.c (grantpt): Free buffer allocated by
	pts_name before return.

1998-09-18 11:15  Ulrich Drepper  <drepper@cygnus.com>

	* math/math.h: Define __NO_MATH_INLINES if __STRICT_ANSI__.

1998-09-18  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* login/openpty.c: Include pty-private.h instead of
	pty-internal.h.

1998-09-09  Philip Blundell  <pb@nexus.co.uk>

	* sysdeps/arm/dl-machine.h (elf_machine_lazy_rel): Optimise a bit.

1998-09-07  Philip Blundell  <pb@nexus.co.uk>

	* sysdeps/arm/dl-machine.h (RTLD_START): Keep in step with
	recent ld.so changes.
	(elf_machine_runtime_setup): Correct behaviour when profiling.

1998-09-17 19:34  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/unix/sysv/sysv4/bits/utsname.h: Fix typo.
	Patch by John Tobey <jtobey@banta-im.com>.

1998-09-17  Mark Kettenis  <kettenis@phys.uva.nl>

	* login/pty-internal.h: Removed.  Moved constants related to the
	`grantpt' helper program protocol to ...
	* login/pty-private.h: ... here.  New file.
	* sysdeps/unix/sysv/linux/ptsname.c (ptsname): Reimplementation
	to make the function work with kernels >= 2.1.115.
	* sysdeps/unix/sysv/linux/getpt.c (getpt): Reimplement to call BSD
	version if using the cloning device fails.
	* sysdeps/unix/sysv/linux/grantpt.c: New file.
	* sysdeps/unix/sysv/linux/unlockpt.c: General cleanup.
	* sysdeps/unix/bsd/getpt.c (__getpt): Largely rewritten to allow
	use by Linux specific code.
	* sysdeps/unix/bsd/unlockpt.c: General cleanup.
	* sysdeps/unix/grantpt.c: Largely rewritten.  (pts_name): New
	function.  (grantpt): Use pts_name, check group and permission
	mode in addition to owner.  Try to set the owner, group and
	permission mode first without invoking the helper program.
	* login/programs/pt_chown.c: Largely rewritten.  Add argp and
	internationalization support.  Use symbolic constants instead of
	hardwired numbers for permission mode.
	* sysdeps/unix/bsd/ptsname.c: New file.

1998-09-17 22:04  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp-test.c: Undo last change.

	* posix/wordexp.c: Undo last change.

1998-09-16  Ulrich Drepper  <drepper@cygnus.com>

	* nscd/grpcache.c (save_grp): Partly undo last change.

	* nscd/pwdcache.c (save_pwd): Undo last change.

1998-09-14  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* sysdeps/mach/hurd/dl-cache.c (_dl_unload_cache): New dummy
	function.  Reported by okuji@kuicr.kyoto-u.ac.jp [PR libc/789].

1998-09-15  David S. Miller  <davem@pierdol.cobaltmicro.com>

	* sysdeps/sparc/sparc32/dl-machine.h (elf_machine_runtime_setup):
	Add profiling support.
	(TRAMPOLINE_TEMPLATE): New macro.
	(ELF_MACHINE_RUNTIME_TRAMPOLINE): Define in terms of that.
	(RTLD_START): Prettify, and set __libc_stack_end properly.
	(elf_machine_rela) [R_SPARC_COPY]: Remove RTLD_BOOTSTRAP ifndef
	and check for sym being NULL instead.
	* sysdeps/sparc/sparc64/addmul_1.S: Adjust to allocate 192 bytes
	of stack space.
	* sysdeps/sparc/sparc64/lshift.S: Likewise.
	* sysdeps/sparc/sparc64/mul_1.S: Likewise.
	* sysdeps/sparc/sparc64/rshift.S: Likewise.
	* sysdeps/sparc/sparc64/submul_1.S: Likewise.
	* sysdeps/sparc/sparc64/elf/crtbegin.S: Likewise and remove old
	MEDANY code model %g4 usage.
	* sysdeps/sparc/sparc64/elf/crtend.S: Likewise and remove old
	MEDANY code model %g4 usage.
	* sysdeps/sparc/sparc64/elf/start.S: Rework to not use old FULLANY
	code model address formation.
	* sysdeps/sparc/sparc64/dl-machine.h: Don't include link.h, do
	include elf/ldsodefs.h
	(DT_SPARC): Remove.
	(elf_machine_matches_host): It is now EM_SPARCV9.
	(elf_machine_dynamic): Clean up to remove ugly cast.
	(elf_machine_fixup_plt): Rework for new V9 ABI, add support for
	new PLT formats.
	(elf_machine_rela): Don't do anything at all for R_SPARC_NONE.
	Prettify rest of function.
	[R_SPARC_COPY]: Check for sym being NULL.
	[R_SPARC_32]: Handle it.
	[R_SPARC_H44, R_SPARC_M44, R_SPARC_L44]: Handle them for the
	MEDMID code model.
	[R_SPARC_HH22, R_SPARC_HM10, R_SPARC_LM22]: Handle them for the
	MEDANY code model.
	[R_SPARC_NONE]: Remove this case, as it is now checked earlier.
	(elf_machine_runtime_setup): Rewrite for new V9 ABI plt formats.
	Add profiling support.
	(TRAMPOLINE_TEMPLATE): New macro.
	(ELF_MACHINE_RUNTIME_TRAMPOLINE): Define in terms of that.
	(RTLD_START): Prettify and set __libc_stack_end.
	* sysdeps/unix/sysv/linux/sparc/bits/sigaction.h (SA_SIGINFO):
	Define.
	* sysdeps/unix/sysv/linux/sparc/bits/signum.h (_NSIG): Set to 64.
	(SIGRTMIN, SIGRTMAX, __SIGRTMIN, __SIGRTMAX): Define.
	* sysdeps/unix/sysv/linux/sparc/sparc32/brk.c (__brk): Remove
	unused variable scratch.
	* sysdeps/unix/sysv/linux/sparc/sparc32/sigaction.c
	(__syscall_rt_sigaction, __rt_sigreturn_stub, __sigreturn_stub):
	Declare.
	(__sigaction): Rewrite rt_sigaction case to pass correct sigreturn
	stub to rt_sigaction syscalls.  Rewrite non-rt case to use correct
	old format kernel sigaction structures.
	* sysdeps/unix/sysv/linux/sparc/sparc64/ucontext.h: Move...
	* sysdeps/unix/sysv/linux/sparc/sparc64/sys/ucontext.h: to here.
	* sysdeps/unix/sysv/linux/sparc/sparc64/Dist: Remove ucontext.h
	* sysdeps/unix/sysv/linux/sparc/sparc64/bits/setjmp.h: Fix
	ucontext include.
	(_JMPBUF_UNWINDS): Define.
	* sysdeps/unix/sysv/linux/sparc/sparc64/bits/statfs.h: Declare
	statfs64 structure, which is exactly the same as the normal one.
	* sysdeps/unix/sysv/linux/sparc/sparc64/brk.S: Allocate 192 bytes
	of stack.  Use correct syscall trap number.  Add branch prediction
	settings to branch instructions.  Remove old MEDANY code model %g4
	referneces for non-PIC.
	* sysdeps/unix/sysv/linux/sparc/sparc64/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/init-first.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/pipe.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscall.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/longjmp.S: Add
	__libc_longjmp and __libc_siglongjmp strong aliases.
	* sysdeps/unix/sysv/linux/sparc/sparc64/readdir.c (__readdir64):
	Also define to __no__readdir64_decl around readdir.c inclusion.
	(__readdir64): Add strong alias.
	* sysdeps/unix/sysv/linux/sparc/sparc64/socket.S: New file.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list (getrlimit):
	Set strong and weak names properly.

1998-09-16 11:25  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* manual/Makefile (AWK): Default to gawk if standalone.

1998-09-15  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makefile (distribute): Undo last change.
	* Make-dist (+tsrc) [not subdir]: Also include indirection headers
	for sysdep headers.
	(+subdir-headers): Removed, unused.

1998-09-15  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* stdio-common/Makefile ($(inst_includedir)/bits/stdio_lim.h): Use
	$(do-install).

1998-09-15  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makerules ($(+sysdir_pfx)sysd-Makefile): Don't check for
	absolute name in $(config-sysdirs), can never happen.
	($(+sysdir_pfx)sysd-rules): Likewise.
	* Makeconfig (full-config-sysdirs): Likewise.
	(all-Subdirs-files): Prepend $(..).

	* configure.in: Don't check for absolute name in $add_ons_pfx, can
	not happen.  Let --enable-add-ons=yes work if no add-ons actually
	exist.

1998-09-15  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Rules ($(common-objpfx)bits/stdio_%.h): Remove extra
	continuations in command.

1998-09-15  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* libio/oldstdfiles.c (_IO_stdin_used): Update declaration.

1998-09-16 00:47  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp-test.c: If expansion or substitution occurs
	anywhere in a word, the entire word is subject to field-splitting.

	* posix/wordexp.c (parse_glob): Look for end of word instead of
	end of field when deciding what to glob.
	(field_split_word): New function, now the only place where
	field-splitting is performed.
	(parse_dollars): New parameter - tell the caller if
	field-splitting should be performed on this word.

	* posix/wordexp-test.c (testit): Only call wordfree if wordexp
	succeeded (or failed with WRDE_NOSPACE).

1998-09-15 19:53 1998  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp.c (wordexp): Don't convert IFS characters to
	blanks.

	* posix/wordexp-test.c: Words not the result of expansion or
	substitution should remain unchanged.

1998-09-15  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dynamic-link.h [!ELF_MACHINE_PLTREL_OVERLAP]
	(_ELF_DYNAMIC_DO_RELOC): Correctly set ranges[1].lazy.

1998-09-15  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* stdio-common/Makefile: Include Makeconfig so that
	$(inst_includedir) is defined.

1998-09-14  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* io/pwd.c: Include <mcheck.h>.

1998-09-15 08:00  Ulrich Drepper  <drepper@cygnus.com>

	* nscd/pwdcache.c (save_pwd): Correct copying.
	* nscd/grpcache.c (save_grp): Likewise.

1998-09-14 23:36  Ulrich Drepper  <drepper@cygnus.com>

	* nscd/pwdcache.c (save_pwd): Rewrite to use only one malloc call.
	(free_pwd): Adjust for this change.
	* nscd/grpcache.c (save_grp): Rewrite to use only one malloc call.
	(free_grp): Adjust for this change.

1998-09-14  Ulrich Drepper  <drepper@cygnus.com>

	* nscd/pwdcache.c (cache_pwdinit): Allocate uidtbl of correct size.

1998-09-14 15:29  Ulrich Drepper  <drepper@cygnus.com>

	* stdio-common/Makefile (headers): Remove bits/stdio_lim.h.
	(install-others): Add bits/stdio_lim.h.
	Add rule to install bits/stdio_lim.h.

	* sysdeps/unix/sysv/sysv4/solaris2/sparc/Dist: New file.

	* Makefile (distribute): Add include/sys/mman.h.

	* sysdeps/powerpc/Dist: Add dl-machine.c and dl-start.S.
	* sysdeps/unix/sysv/linux/Dist: Add sys/sendfile.h.
	* sysdeps/unix/sysv/linux/arm/Dist: Add init-first.h.

	* grp/initgroups.c: Include stdlib.h.
	Patch by Zack Weinberg.

1998-09-14 22:46  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp-test.c: Chet Ramey confirmed that bash's behaviour
	for field-splitting :abc: is correct, and that two fields should
	result. Revert tests to reflect this.

	* posix/wordexp.c (w_emptyword): Remove function.
	(exec_comm): Don't use w_emptyword.
	(parse_param): Likewise.

1998-09-14 15:00  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/arm/fpu/Dist: Moved to...
	* sysdeps/arm/Dist: ...here.
	* sysdeps/posix/Dist: Removed.
	* sysdeps/unix/sysv/linux/Dist: Move sys/debugreg.h to...
	* sysdeps/unix/sysv/linux/i386/Dist: ...here.

1998-08-26  Geoff Keating  <geoffk@ozemail.com.au>

	* csu/init.c: Don't drag _IO_2_1_stdin_ into the executable.

1998-09-14 11:26  Ulrich Drepper  <drepper@cygnus.com>

	* wcsmbs/wcsmbs-tst1.c: Include stdlib.h.

1998-09-14  Thorsten Kukuk  <kukuk@vt.uni-paderborn.de>

	* libc-work/nis/nss_nisplus/nisplus-service.c
	(_nss_nisplus_parse_servent): Convert port in network byte order.

1998-09-14 07:53 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* stdlib/stdlib.h: Add a switch, __need_malloc_and_calloc,
	to provide only malloc and calloc.
	* include/stdlib.h: Support the above.
	* string/bits/string2.h: Use __need_malloc_and_calloc when
	including stdlib.h.
	(__string2_1bptr_p): Avoid -Wbad-function-cast warnings.

	* iconvdata/iso-2022-jp.c: Include <stdlib.h>.
	* iconvdata/iso646.c: Include <stdlib.h>.

1998-09-14 07:51 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* sunrpc/rpc_cout.c: Add braces around ambiguous else.
	* sysdeps/libm-ieee754/w_pow.c: Likewise.
	* sysdeps/libm-ieee754/w_powf.c: Likewise.
	* sysdeps/libm-ieee754/w_powl.c: Likewise.

1998-09-14 07:57 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* stdio-common/stdio_lim.h.in: New file.  All parameters
	are adjustable at build time.
	* Rules: Add a rule to build bits/stdio_lim.h from
	stdio-common/stdio_lim.h.in.  (It has to be in Rules so that
	all subdirectories know how to make the file.  It can't be
	in Makerules because then it gets built at top level and the
	dependencies are wrong.)

	* stdio-common/Makefile (distribute): Add stdio_lim.h.in.
	* sysdeps/unix/sysv/linux/Makefile: Delete rules to make
	stdio_lim.h.
	* sysdeps/unix/sysv/linux/stdio_lim.h.in: Removed.
	* sysdeps/unix/sysv/linux/Dist: Take out stdio_lim.h.in.
	* sysdeps/posix/Makefile: Removed.
	* sysdeps/posix/mk-stdiolim.c: Removed.
	* sysdeps/generic/bits/stdio_lim.h: Removed.

1998-09-12  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* argp/argp-help.c: Fixup indentation.
	* nss/nss_files/files-alias.c: Quiet -Wparentheses warning.
	* resolv/nss_dns/dns-network.c: Likewise.
	* resolv/res_send.c: Likewise.
	* rt/aio_cancel.c: Likewise.
	* rt/aio_misc.c: Likewise.

1998-09-12  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makefile (install-symbolic-link): Remove the link list file at last.
	* Makerules (install-clean-symbolic-link-list): Removed.

1998-09-12  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* timezone/tst-timezone.c: Print time in UTC to get consistent
	output.

1998-09-12  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/rtld.c (_dl_rpath): Removed.
	* elf/dl-support.c (_dl_path): Removed.
	* elf/Makefile ($(objpfx)ld.so): Don't pass -rpath.
	(CFLAGS-dl-support.c): Removed.

	* elf/dl-load.c (env_path_list): Renamed from fake_path_list.  All
	uses changed.
	(_dl_init_paths): Always set env_path_list from LD_LIBRARY_PATH,
	instead of appending it to the main map's rpath info.
	(_dl_map_object): Consistently use LD_LIBRARY_PATH after all
	DT_RPATHs.  This makes it effective again.
	(decompose_rpath): Remove second parameter, callers changed.
	(fillin_rpath): Allocate enough space in curwd.
	(expand_dynamic_string_token): Cope with get_origin returning -1.

1998-09-14  Thorsten Kukuk  <kukuk@vt.uni-paderborn.de>

	* libc-work/nis/nss_compat/compat-pwd.c: Add support for
	passwd.adjunct.

	* nis/nss_nis/nis-pwd.c (_nss_nis_getpwent_r): Correct test for
	invalid password.

1998-09-13 18:06  Ulrich Drepper  <drepper@cygnus.com>

	* locale/programs/locale.c: Update dates.

1998-09-13  Mark Kettenis  <kettenis@phys.uva.nl>

	* sysdeps/generic/bits/types.h: Include <features.h>.  Make sure
	size_t is defined.  Some reordering of defenitions to make
	maintaining this file in parallel with the linux-specific file easier.

1998-09-13  Ulrich Drepper  <drepper@cygnus.com>

	* io/pwd.c (main): Add call to mtrace.

	* malloc/mtrace.pl: Quote @ in string.

1998-09-13 19:25  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp.c (parse_arith): Fix memory leaks.
	(exec_comm): Likewise.
	(parse_param): Likewise.
	(wordexp): Likewise.
	(exec_comm): Reduce number of function return points.
	(parse_param): Likewise.
	(wordexp): Likewise.

1998-09-13 14:53  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp-test.c: Field-splitting ':abc:' with IFS=: should
	yield three fields, not two.  Test both parameter expansion and
	command substitution for correct field-splitting behaviour.

	* posix/wordexp.c (w_emptyword): New function.
	(parse_param): Use it.
	(exec_comm): Likewise, for consistency with the way parse_param
	splits fields.
	(parse_param): Fix some memory leaks.

1998-09-13 18:04  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/powerpc/dl-machine.c (PPC_DCBST,PPC_SYNC,PPC_ISYNC,PPC_ICBI):
	Don't mark asm `volatile'.
	(__elf_machine_runtime_setup): Clear the last partial block in the PLT
	from the data cache too.  Assume it isn't in the instruction cache yet.
	(__elf_machine_fixup_plt): Clear the modified address from the caches.

1998-09-12  Mark Kettenis  <kettenis@phys.uva.nl>

	* sysdeps/generic/segfault.c (install_handler): Install signal
	handler with SA_ONSTACK instead of setting the stack flags to
	SS_ONSTACK.  Do not install handler for SIGSTKFLT if it is not
	defined.

1998-09-12 14:24 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* signal/signal.h: Fix multiple inclusion guard to cover the
	entire file.
	* wcsmbs/wchar.h: Remove prototype of internal function
	__mbsrtowcs.
	* sysdeps/i386/i486/bits/string.h (memchr): Don't do
	arithmetic on `void *'.

1998-09-12 01:09  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp-test.c: Fix wrong tests.  Add new tests.

	* posix/wordexp.c (wordexp): Perform word-splitting instead of
	field-splitting here.
	(wordexp): If out of memory mid-word, free the word (but still
	leave pwordexp alone for caller to see).
	(parse_param): Allow for zero-length fields (smarter checking of
	memory allocation failure).
	(w_addword): Convert NULL words to "".
	(wordexp): Convert left-over IFS characters to blanks (like bash).

1998-09-11  Ulrich Drepper  <drepper@cygnus.com>

	* configure.in: Use test -f instead of test -e.
	Patch by John Tobey <jtobey@banta-im.com>.

	* sysdeps/unix/sysv/sysv4/solaris2/sparc/sys/trap.h: New file.
	* sysdeps/unix/sysv/sysv4/solaris2/sys/syscall.h: New file.
	* sysdeps/unix/sysv/sysv4/solaris2/bits/sigstack.h: New file.
	* sysdeps/unix/sysv/linux/sigstack.c: Fix typo.
	* sysdeps/unix/sysv/sysv4/solaris2/sigwaitinfo.c: Fix typo.
	* sysdeps/unix/sysv/sysv4/solaris2/sparc/sys/ucontext.h: New file.
	* sysdeps/unix/sysv/sysv4/solaris2/sys/param.h: New file.
	Patches by John Tobey <jtobey@banta-im.com>.

	* time/strftime.c (my_strftime): Delay use of *tp values until
	latest possible point to allow partly initialized structures
	(e.g., from strptime).

	* iconvdata/Makefile (modules): Add ISO_10367-BOX, MAC-IS, NATS-DANO,
	and NATS-SEFI.
	Define *-routines variables for new modules.
	(distribute): Add .c files for new modules.
	(awk-generated-headers): Add iso_10367-box.h, mac-is.h, nats-dano.h,
	and nats-sefi.h.
	Add rules for header generation.
	* iconvdata/gconv-modules: Add entries for new modules.
	* iconvdata/iso_10367-box.c: New file.
	* iconvdata/mac-is.c: New file.
	* iconvdata/nats-dano.c: New file.
	* iconvdata/nats-sefi.c: New file.

1998-04-30 18:20  H.J. Lu  <hjl@gnu.org>

	* elf/dl-load.c (_dl_init_paths): Don't check the dynamic
	loader if PIC is not defined.

1998-09-11  Ulrich Drepper  <drepper@cygnus.com>

	* iconvdata/Makefile (modules): Add CSN_369103, CWI, DEC-MCS,
	ECMA-CYRILLIC, GOST_19768-74, GREEK-CCITT, GREEK7, GREEK7-OLD, INIS,
	INIS-8, INIS-CYRILLIC, ISO_6937-2, ISO_2033, ISO_5427, ISO_5427-EXT,
	and ISO_5428.
	Define *-routines variables for new modules.
	(distribute): Add .c files for new modules.
	(awk-generated-headers): Add csn_369103.h, cwi.h, dec-mcs.h,
	ecma-cyrillic.h, gost_19768-74.h, greek-ccitt.h, greek7.h,
	greek7-old.h, inis.h, inis-8.h, inis-cyrillic.h, iso_2033.h,
	iso_5427.h, iso_5427-ext.h, and iso_5428.h.
	Add rules for header generation.
	* iconvdata/gconv-modules: Add entries for new modules.
	* iconvdata/csn_369103.c: New file.
	* iconvdata/cwi.c: New file.
	* iconvdata/dec-mcs.c: New file.
	* iconvdata/ecma-cyrillic.c: New file.
	* iconvdata/gost_19768-74.c: New file.
	* iconvdata/greek-ccitt.c: New file.
	* iconvdata/greek7-old.c: New file.
	* iconvdata/greek7.c: New file.
	* iconvdata/inis-8.c: New file.
	* iconvdata/inis-cyrillic.c: New file.
	* iconvdata/inis.c: New file.
	* iconvdata/iso6937-2.c: New file.
	* iconvdata/iso_2033.c: New file.
	* iconvdata/iso_5427-ext.c: New file.
	* iconvdata/iso_5427.c: New file.
	* iconvdata/iso_5428.c: New file.

	* iconvdata/iso6937.c (from_ucs4): Correct 0x80, 0x81, and 0xb9
	entries.
	Convert U02dd correctly.

1998-09-11 20:46  Richard Henderson  <rth@cygnus.com>

	* sysdeps/alpha/dl-machine.h (_dl_start_user): Pass pointer to
	_dl_main_searchlist not _dl_default_scope to _dl_init_next.
	* sysdeps/sparc/sparc32/dl-machine.h (_dl_start_user): Likewise.
	* sysdeps/sparc/sparc64/dl-machine.h (_dl_start_user): Likewise.

1998-09-11  Ulrich Drepper  <drepper@cygnus.com>

	* resolv/res_init.c (res_init): Handle resolv.conf file with only
	one nameserver correctly.  Patch by HJ Lu.

	* iconvdata/Makefile (modules): Add IEC_P27-1, BALTIC, ASMO_449,
	and ANSI_X3.110.
	Define *-routines variables for new modules.
	(distribute): Add .c files for new modules.
	(awk-generated-headers): Add iec_p27-1.h, baltic.h, and asmo_449.h.
	Add rules for hedaer generation.
	* iconvdata/gconv-modules: Add entries for new modules.  Pretty print.
	* iconvdata/ansi_x3.110.c: New file.
	* iconvdata/asmo_449.c: New file.
	* iconvdata/baltic.c: New file.
	* iconvdata/iec_p27-1.c: New file.

	* iconvdata/t61.c (from_ucs4): Correct 0x23, 0x24, 0x80, and 0x81
	entries.
	Convert U02dc correctly.

	* math/atest-exp.c: Add parentheses to avoid gcc warnings.
	* math/atest-exp2.c: Likewise.
	* math/atest-sincos.c: Likewise.

	* posix/getopt.h: Don't define non-POSIX stuff unless _GNU_SOURCE
	is defined.

1998-09-11 10:51  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* string/strcoll.c: Optimize a few expressions.
	* string/strxfrm.c: Likewise.

1998-09-02  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* manual/locale.texi: Fix typos.

1998-09-10  Ulrich Drepper  <drepper@cygnus.com>

	* stdlib/random_r.c (__setstate_r): Allow call with same state
	array as currently used (PR libc/774).

	* include/limits.h: Include gcc's header even if this file is
	found more than once before it (PR libc/778)

	* sysdeps/unix/sysv/linux/Makefile [subdir==misc]
	(sysdep_headers): Remove sys/debugreg.h.
	* sysdeps/unix/sysv/linux/i386/Makefile [subdir==misc]
	(sysdep_headers): Add sys/debugreg.h.
	* sysdeps/unix/sysv/linux/sys/debugreg.h: Removed.
	* sysdeps/unix/sysv/linux/i386/sys/debugreg.h: New file.

	* stdio-common/tmpnam.c: Move local static variable buf to
	toplevel and rename to tmpnam_buffer to ease debugging.
	Patch by Joe Keane <jgk@jgk.org>.
	Optimize s == NULL case a bit.

	* iconvdata/testdate/ISO-8859-10..UCS2: Update after charmap
	correction.

1998-09-10 12:51  Ulrich Drepper  <drepper@cygnus.com>

	* resolv/res_init.c (res_init): Initialize _res.nscount and
	_res.nsaddr.sin_port differently for the can when no loopback
	is available to allow immediate timeout in non-networking environments.
	Patch by Cristian Gafton <gafton@redhat.com>.

1998-09-10  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* localedata/charmaps/ISO-8859-10: Character 0xBD is HORIZONTAL
	BAR and not EM DASH.
	* localedata/charmaps/ISO_8859-SUPP: Likewise (character 0xD0).
	* localedata/charmaps/ISO-8859-7: Likewise (character 0xAF).
	Fixes PR libc/717.

1998-09-10 11:53  Ulrich Drepper  <drepper@cygnus.com>

	* timezone/Makefile: Add rules to generate Asia/Tokyo zoneinfo files
	for test.
	* timezone/tst-timezone.c (tests): Fix typo in last patch.

	* time/tzfile.c (__tzfile_read): Handle case when there are no
	transitions.  Set __timezone based on computed offset.
	* time/tzset.c (tzset_internal): Set __timezone before returning.

	* time/tzset.c (tzset_internal): Optimize handling of local string
	copy.

1998-09-10  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* timezone/tst-timezone.c (tests): Add test for Asia/Tokyo (see PR
	libc/776).

1998-09-09  Benjamin Kosnik  <bkoz@tintin.cygnus.com>

	* math/libm-test.c (exp10_test): Adapt epsilons for powerpc.
	(csqrt_test): Likewise.
	* sysdeps/powerpc/bits/fenv.h: Add parens.

1998-09-09 18:48  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/powerpc/dl-start.S (_start): Pass pointer to
	_dl_main_searchlist not _dl_default_scope to _dl_init_next.
	Patch by Benjamin Kosnik <bkoz@cygnus.com>.

1998-09-09  Mark Kettenis  <kettenis@phys.uva.nl>

	* elf/dl-close.c (_dl_close): Don't free imap->l_origin if it is
	the special `-1' pointer.

1998-09-09 09:32  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/powerpc/dl-machine.h (elf_machine_rela): Make function
	inline.

1998-09-07  Paul Eggert  <eggert@twinsun.com>

	* time/mktime.c (__EXTENSIONS__): Define if not defined.
	(_REENTRANT): Remove.  It has undesirable consequences in
	Solaris 2.6 (e.g. it turns off the putc macro).  Defining
	__EXTENSIONS__ makes localtime_r and gmtime_r visible, which
	is what we want.
	* time/strftime.c: Likewise.

1998-09-08  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/dl-error.c: Fix spelling.

1998-09-08  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* stdlib/strfmon.c: Quiet -Wparentheses warnings.
	* stdio-common/_itoa.c: Likewise.
	* stdio-common/printf_fp.c: Likewise.
	* stdio-common/vfscanf.c: Likewise.
	* wcsmbs/wcstok.c: Likewise.
	* sysdeps/generic/glob.c: Likewise.
	* posix/getopt.c: Likewise.
	* sysdeps/posix/getaddrinfo.c: Likewise.
	* posix/wordexp.c: Likewise.
	* io/ftw.c: Likewise.
	* io/fts.c: Likewise.
	* misc/getpass.c: Likewise.
	* iconv/gconv_conf.c: Likewise.
	* argp/argp-fmtstream.c: Likewise.
	* argp/argp-help.c: Likewise.
	* elf/dl-load.c: Likewise.
	* locale/programs/stringtrans.c: Likewise.
	* catgets/gencat.c: Likewise.
	* posix/getconf.c: Likewise.
	* iconv/gconv_conf.c: Likewise.
	* iconv/iconv_prog.c: Likewise.

	* string/strcoll.c: Optimize a few expressions.
	* string/strxfrm.c: Likewise.

1998-09-08  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/dl-open.c (dl_open_worker): Move decl of new_global up one
	level to avoid uninit variable warning.

1998-09-09 10:34  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/m68k/dl-machine.h(RTLD_START): Push _dl_main_searchlist
	instead of _dl_default_scope[2] as argument to _dl_init_next.

	* sysdeps/m68k/fpu/bits/mathinline.h (isinf): Avoid conflict with
	C9x macro.

1998-09-08  Ulrich Drepper  <drepper@cygnus.com>

	Fix compatibility problems introduced in last change.
	* csu/initfini.c: Don't define __gmon_start__ if WEAK_GMON_START is
	defined.
	* sysdeps/unix/sysv/linux/i386/Makefile [subdir==csu]: Add
	-DWEAK_GMON_START to CFLAGS-initfini.s.

	* elf/dl-object.c (_dl_new_object): Store map address in
	_dl_loaded if _dl_loaded is NULL.
	* elf/rtld.c (dl_main): Don't update _dl_loaded here.

	* sysdeps/generic/setrlimit64.c: Remove stub warning.

1998-09-07  Ulrich Drepper  <drepper@cygnus.com>

	* db2/common/db_apprec.c (__db_apprec): Add braces to make gcc
	quiet.
	* db2/btree/bt_cursor.c: Likewise.
	* db2/common/db_region.db_c: Likewise.
	* db2/common/db_salloc.db_c: Likewise.
	* db2/db/db.c: Likewise.
	* db2/db/db_rec.c: Likewise.
	* db2/hash/hash.c: Likewise.
	* db2/hash/hash_page.c: Likewise.
	* db2/hash/hash_rec.c: Likewise.
	* db2/log/log_findckp.c: Likewise.
	* db2/log/log_get.c: Likewise.
	* db2/log/log_put.c: Likewise.
	* db2/mp/mp_fget.c: Likewise.
	* db2/mp/mp_fput.c: Likewise.
	* db2/mp/mp_region.c: Likewise.
	* stdlib/strtol.c: Likewise.
	* string/strcoll.c: Likewise.
	* string/strxfrm.c: Likewise.
	* argp/argp-help.c: Likewise.
	* argp/argp-parse.c: Likewise.
	* resolv/res_debug.c: Likewise.

1998-09-07 09:58  Ulrich Drepper  <drepper@cygnus.com>

	* math/tgmath.h (scalb): Only define for __USE_MISC or
	__USE_XOPEN_EXTENDED.  Patch by Zack Weinberg.

1998-09-06  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* libio/stdio.h: Fix comment.

	* stdio/stdio.h: Make vfscanf, vscanf and vsscanf available if
	__USE_ISOC9X.

1998-09-06 09:53 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* Makeconfig (+gccwarn): Remove -Wno-parentheses.

	* elf/dl-open.c: Quiet -Wparentheses warnings.
	* iconvdata/johab.c: Likewise.
	* iconvdata/uhc.c: Likewise.
	* inet/inet_net.c: Likewise.
	* io/fts.c: Likewise.
	* locale/newlocale.c: Likewise.
	* misc/getttyent.c: Likewise.
	* misc/mntent_r.c: Likewise.
	* misc/ttyslot.c: Likewise.
	* nscd/nscd_conf.c: Likewise.
	* nss/nsswitch.c: Likewise.
	* resolv/gethnamaddr.c: Likewise.
	* resolv/nsap_addr.c: Likewise.
	* resolv/res_debug.c: Likewise.
	* stdio-common/_itoa.c: Likewise.
	* stdlib/strtod.c: Likewise.
	* string/strverscmp.c: Likewise.
	* sunrpc/svc.c: Likewise.
	* sysdeps/libm-ieee754/e_cosh.c: Likewise.
	* sysdeps/libm-ieee754/e_gamma_r.c: Likewise.
	* sysdeps/libm-ieee754/e_sinh.c: Likewise.
	* sysdeps/posix/getaddrinfo.c: Likewise.

1998-09-06 15:13  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dlsym.c (dlsym_doit): Use new RTLD_DEFAULT macro to test
	for use of global scope.
	* elf/dlvsym.c (dlvsym_doit): Likewise.

1998-09-02  Paul Eggert  <eggert@twinsun.com>

	* strftime.c (my_strftime): When mbrlen returns (size_t) -2,
	copy the redundant bytes at the end of the format as-is; don't
	just copy their first byte and then rescan, as that might get
	us an encoding error.
	Account correctly for the length of multibyte sequences in the
	format.

1998-09-03 20:14  Tim Waugh  <tim@cyberelk.demon.co.uk>

	* posix/wordexp-test.c: Add tests for different IFS values.
	Change unquoted-newline test so that newline is not in IFS.

	* posix/wordexp.c (wordexp): Correct null/unset mix-up when
	determining IFS characters.  Return WRDE_BADCHAR for unquoted
	special characters _except_ if they are separators.

1998-09-06 10:56  Ulrich Drepper  <drepper@cygnus.com>

	* include/tgmath.h: New file.

	* libio/stdio.h: Correct reversed #ifs.
	Patch by Zack Weinberg.

	* manual/creature.texi: Better explain reason for feature select
	macros.
	Patch by Michael Deutschmann <michael@talamasca.wkpowerlink.com>.

1998-09-06 10:25 -0400  Zack Weinberg  <zack@rabi.phys.columbia.edu>

	* include/alloca.h: Add multiple-inclusion guard.
	* include/db.h: Likewise.
	* include/db_185.h: Likewise.
	* include/dlfcn.h: Likewise.
	* include/fcntl.h: Likewise.
	* include/grp.h: Likewise.
	* include/libintl.h: Likewise.
	* include/mntent.h: Likewise.
	* include/pwd.h: Likewise.
	* include/sched.h: Likewise.
	* include/search.h: Likewise.
	* include/setjmp.h: Likewise.
	* include/shadow.h: Likewise.
	* include/signal.h: Likewise.
	* include/stdio.h: Likewise.
	* include/stdlib.h: Likewise.
	* include/string.h: Likewise.
	* include/termios.h: Likewise.
	* include/time.h: Likewise.
	* include/ulimit.h: Likewise.
	* include/utmp.h: Likewise.
	* include/wchar.h: Likewise.
	* include/sys/file.h: Likewise.
	* include/sys/gmon.h: Likewise.
	* include/sys/ioctl.h: Likewise.
	* include/sys/mman.h: Likewise.
	* include/sys/resource.h: Likewise.
	* include/sys/select.h: Likewise.
	* include/sys/socket.h: Likewise.
	* include/sys/statfs.h: Likewise.
	* include/sys/time.h: Likewise.
	* include/sys/times.h: Likewise.
	* include/sys/wait.h: Likewise.

1998-09-06 09:00  Ulrich Drepper  <drepper@cygnus.com>

	* version.h (VERSION): Bump to 2.0.96.

	Rewrite runtime linker to be truly thread-safe.  There is now no
	global variable specifying the scope.  We create all needed
	scopes at the time the link maps are created.
	* elf/Versions [GLIBC_2.1]: Add _dl_loaded and _dl_main_searchlist.
	* elf/link.h: Add struct r_scope_elem and use this for l_searchlist,
	l_symbolic_searchlist, l_scope, and l_local_scope elements in
	struct link_map.
	* elf/dl-close.c: Rewritten accordingly.
	* elf/dl-deps.c: Likewise.
	* elf/dl-error.c: Likewise.
	* elf/dl-init.c: Likewise.
	* elf/dl-load.c: Likewise.
	* elf/dl-lookup.c: Likewise.
	* elf/dl-object.c: Likewise.
	* elf/dl-open.c: Likewise.
	* elf/dl-reloc.c: Likewise.
	* elf/dl-runtime.c: Likewise.
	* elf/dl-support.c: Likewise.
	* elf/dl-symbol.c: Likewise.
	* elf/dl-version.c: Likewise.
	* elf/dlsym.c: Likewise.
	* elf/dlvsym.c: Likewise.
	* elf/ldsodefs.h: Likewise.
	* elf/rtld.c: Likewise.
	* iconv/gconv_dl.c: Likewise.
	* nss/nsswitch.c: Likewise.
	* sysdeps/i386/dl-machine.h: Likewise.
	* sysdeps/unix/sysv/linux/i386/dl-librecon.h: Likewise.

	* elf/dlfcn.h: Declare dladdr only for __USE_GNU.
	Define RTLD_DEFAULT.

1998-09-05  Mark Kettenis  <kettenis@phys.uva.nl>

	* sysdeps/mach/hurd/i386/init-first.c (init1): Call
	__getopt_clean_environment with __environ instead of envp.

1998-09-05  Roland McGrath  <roland@baalperazim.frob.com>

	* sysdeps/mach/hurd/i386/Makefile (omit-deps): Define to crt0.

	* string/argz-extract.c (__argz_extract): Add de-consting cast for
	setting results.

	* string/argz.h (argz_next): Add de-consting cast for return.
	* string/argz-next.c (__argz_next): Likewise.

	* sysdeps/unix/sysv/linux/Makefile [$(subdir)=inet] (sysdep_headers):
	Don't add netinet/udp.h, netinet/ip_icmp.h here.
	* sysdeps/gnu/Makefile: Do it here instead.
	* sysdeps/unix/sysv/linux/Dist: Move those files from here ...
	* sysdeps/gnu/Dist: ... to here.

	* sysdeps/unix/sysv/linux/netinet/ip_icmp.h,
	sysdeps/unix/sysv/linux/netinet/tcp.h,
	sysdeps/unix/sysv/linux/netinet/udp.h: Moved to sysdeps/gnu/netinet.

1998-09-04  Roland McGrath  <roland@baalperazim.frob.com>

	* string/argz.h (argz_extract, argz_next): Use `const' for ARGZ param.
	* string/argz-next.c, string/argz-extract.c: Fix defns.

1998-09-03  Roland McGrath  <roland@baalperazim.frob.com>

	* mach/Makefile: Use -include for mach-syscalls.mk to silence warning.

	* sysdeps/mach/hurd/sysd-stdio.c: Declare fns
	__stdio_{read,write,seek,close,fileno} using __io_*_fn types.
	* sysdeps/generic/sysd-stdio.c: Likewise.

1998-09-02  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dl-load.c (fillin_rpath): Handle "/" as RPATH correctly.
	(_dl_map_object_from_fd): Make NAME argument const.
	Remove last parameter in _dl_new_object call.
	(print_search_path): Correct construction of composed path name.
	(_dl_map_object): Prevent looking at RPATH of the main map twice.
	Remove last parameter in _dl_new_object call.
	* elf/dl-object.c: Remove last parameter.  Determine whether create
	origin entry based on empty realname.  Handle file in root directory
	correctly.
	* elf/ldsodefs.h: Adjust prototype for _dl_new_object.
	* elf/rtld.c (dl_main): Add comment describing reason for memory leak.
	Remove last parameter in _dl_new_object call.
	* sysdeps/generic/dl-origin.h: Handle file in root directory correctly.
	* sysdeps/unix/sysv/linux/dl-origin.h: Likewise.

1998-09-01  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dl-close.c (_dl_close): Add more comments and correct some.
	Free l_searchlist and l_dupsearchlist.

	* debug/catchsegv.sh: Add one more pair of quotes.

1998-09-01 17:53  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dl-load.c (add_name_to_object): Change return type to void and
	make NAME parameter const.  Allocate room for NAME in same memory
	block used for l_libname entry.
	(_dl_map_object_from_fd): Don't free NAME on failure.
	(map_segment): Pass SONAME to add_name_to_object, not a copy.
	(_dl_map_object): Don't create copy of NAME.  Pass NAME to
	_dl_map_object_from_fd.
	* elf/dl-object.c (dl_new_object): Allocate room for NAME in same
	memory block used for l_libname entry.
	* elf/dl-close.c: Adjust free()ing for this change.

1998-09-01 15:36  Ulrich Drepper  <drepper@cygnus.com>

	* malloc/Makefile: Include Makeconfig before testing config-sysdirs.

	* malloc/mtrace.c: Add bug report address.  Update email address.
	Add more @XXX@ to print correct address size.

	* elf/dl-addr.c (_dl_addr): Make sure that map to be examined is
	really initialized.

	* elf/dl-close.c (_dl_close): Use l_map_start and l_map_end info
	for munmap call instead of examining phdr again.
	Free all malloc()ed strings and arrays.

1998-08-09  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/powerpc/Makefile [subdir=elf]: Add new files split out of
	dl-machine.h.
	* sysdeps/powerpc/dl-machine.c: New file.
	* sysdeps/powerpc/dl-machine.h: Move much stuff into separate
	files.  Revise ELF_PREFERRED_ADDRESS to take account of
	the new mapping information (fixes bug involving huge bloated
	web browser).  Set ELF_MACHINE_PLTREL_OVERLAP.
	* sysdeps/powerpc/dl-start.S: New file.

	* elf/dl-load.c (_dl_map_object_from_fd): Initialise l_map_start,
	l_map_end.
	* elf/do-rel.h: Call elf_machine_rel only once (to save space).
	* elf/dynamic-link.h: Allow PLT relocs to be in the middle of the
	others.  Call elf_dynamic_do_##reloc only once (to save even more
	space).
	* elf/link.h: Add new members l_map_start and l_map_end to keep
	track of the memory map.
	* elf/rtld.c (_dl_start): Initialise l_map_start for ld.so and
	the executable.

1998-09-01 11:53  Ulrich Drepper  <drepper@cygnus.com>

	* debug/Makefile (catchsegv): We need not rewrite SOVER anymore.
	Reported by Andreas Jaeger.

	* posix/glob.h: Use __size_t instead of size_t in definitions and
	make sure this is defined.

1998-09-01 10:34  Ulrich Drepper  <drepper@cygnus.com>

	* manual/locale.texi: Almost complete rewrite.  Document more functions
	and functionality.
	* manual/arith.texi: Correct reference.
	* manual/string.texi: Pretty printing.

	* manual/texinfo.tex: Update from last available version.

1998-08-31 22:44  Ulrich Drepper  <drepper@cygnus.com>

	* nis/nss_nis/nis-pwd.c (_nss_nis_getpwnam_r): Correct test for
	invalid password.
	(_nss_nis_getpwuid_r): Likewise.
	Patch by Matthew Arnison <matthewa@physics.usyd.edu.au>.

	* inet/rcmd.c: Implement netgroup support.
	Patch by Dick Streefland <dick_streefland@tasking.com>.

1998-08-31  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dl-close.c (_dl_close): Update _dl_loaded if the first
	object on the list is removed.  Don't use this code for PIC.
	Reported by HJ Lu [PR libc/770].

1998-08-31 15:56  Ulrich Drepper  <drepper@cygnus.com>

	* db2/db_int.h: Use <db.h> instead of "db.h" to find header in include.

	* include/stdio.h: Add __vsscanf.

	* libio/stdio.h: Make vfscanf, scanf, and vsscanf available if
	__USE_ISOC9X.
	Remove __vsscanf declaration.
	Always declare fgetpos and fsetpos.

	* math/math.h: Define isinf as macro.
	* math/bits/mathcalls.h: Change to declare __isinf all the time.
	Don't declare scalb for ISO C 9x.

	* math/tgmath.h: Define fma.  Rewrite the underlying macros.

	* stdlib/stdlib.h: Declare strtof and strtold is __USE_ISOC9X.

	* sysdeps/unix/sysv/linux/bits/sigcontext.h: Allow inclusion from
	sys/ucontext.h.

	* sysdeps/wordsize-32/inttypes.h: Define missing PRI* and SCN*
	macros.

1998-08-31  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* sysdeps/standalone/bits/errno.h (ENOMSG): Remove duplicate.
	Reported by jreising@frequentis.com [PR libc/767].

1998-08-31  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* io/lockf.c (lockf): Move initilisation of fl.l_whence and
	fl.l_start at beginning of function.
	Patch by Geoff. Dash <geoffd@zeta.org.au> [PR libc/769].

1998-08-31  Ulrich Drepper  <drepper@cygnus.com>

	* io/sys/stat.h (ALLPERMS): Fix type (S_ISTXT -> S_ISVTX).
	Reported by Rob.Hagopian@vu.union.edu [PR libc/763].

	* nscd/nscd.init: Make it work in RedHat systems.
	Patch by Christian Gafton.

1998-08-29  Philip Blundell  <philb@gnu.org>

	* catgets/Makefile: Don't try to run test programs when
	cross-compiling.

1998-08-31  Ulrich Drepper  <drepper@cygnus.com>

	* signal/signal.h: Include bits/sigthread.h only if __USE_POSIX.
	Reported by Zack Weinberg.

1998-08-30  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/sysv/linux/Dist: Add umount.S and umount2.S.
	* elf/Makefile (distribute): Remove ldd.sh.in.

1998-08-31 11:46  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/sysv/linux/dl-origin.h (get_origin): Remove unused
	variable.

1998-08-29  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/i386/register-dump.h: Move to ...
	* sysdeps/unix/sysv/linux/i386/register-dump.h: ...here.

1998-08-28 22:49  Ulrich Drepper  <drepper@cygnus.com>

	* elf/do-rel.h (elf_dynamic_do_rel): Call elf_machine_lazy_rel
	with load address, not map address.
	* sysdeps/alpha/dl-machine.h (elf_machine_lazy_rel): Change first
	parameter and use this value.
	* sysdeps/arm/dl-machine.h: Likewise.
	* sysdeps/i386/dl-machine.h: Likewise.
	* sysdeps/m68k/dl-machine.h: Likewise.
	* sysdeps/mips/dl-machine.h (elf_machine_lazy_rel): Change first
	parameter.
	* sysdeps/powerpc/dl-machine.h: Likewise
	* sysdeps/sparc/sparc32/dl-machine.h: Likewise
	* sysdeps/sparc/sparc64/dl-machine.h: Likewise

1998-08-28 09:22  Ulrich Drepper  <drepper@cygnus.com>

	* elf/rtld.c (process_envvars): Fix copy&paste error.

	* malloc/malloc.c (malloc_hook_ini): Don't overwrite realloc and
	memalign hook.
	(realloc_hook_ini): Don't overwrite memalign hook.
	(memalign_hook_ini): Don't overwrite malloc and memalign hooks.
	Reported by Philippe Troin <phil@fifi.org>.

	* malloc/mcheck.c (mprobe): Call checkhdr with adjusted pointer.
	Patch by Philippe Troin <phil@fifi.org>.

1998-08-26  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/generic/segfault.c (install_handler): Protect the
	non-POSIX signals with #ifdef.
	(catch_segfault): Add missing mode parameter for open.
	* debug/catchsegv.sh: Avoid termination message from shell.  Allow
	other termination signals.

1998-08-27  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* debug/Makefile (distribute): Add register-dump.h.

1998-08-28 10:41  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/sysv/linux/m68k/register-dump.h: New file.

1998-08-27 19:42  Ulrich Drepper  <drepper@cygnus.com>

	* elf/Makefile (distribute): Add dl-origin.h.
	* sysdeps/generic/dl-origin.h: New file.
	* sysdeps/unix/sysv/linux/dl-origin.h: New file.
	* elf/link.h (struct link_map): Add l_origin field.
	* elf/dl-load.c (expand_dynamic_string_token): New function.
	(decompose_path): Remove WHERE argument, take link map pointer instead.
	Call expand_dynamic_string_token instead of local_strdup to make copy
	of rpath.
	(_dl_init_paths): Call decompose_path with correct argument.
	(_dl_map_object_from_fd): Define static is EXTERNAL_MAP_FROM_FD is
	not defined.
	Check EI_OSABI and EI_ABIVERSION fields in header.
	Call _dl_new_object with extra argument.
	(_dl_map_object): Call decompose_path with correct argument.
	Call expand_dynamic_string_token instead of local_strdup to also
	expand DST.
	Call _dl_new_object with extra argument.
	* elf/dl-object.c (_dl_new_object): Determine l_origin for all maps
	but the main one if new argument is nonzero.
	* elf/ldsodefs.h: Adjust for _dl_new_object change.
	* elf/dl-support.c: Define _dl_origin_path.
	* elf/rtld.c: Likewise.  Set _dl_origin_path based on LD_ORIGIN_PATH.
	(dl_main): Call _dl_new_object with extra argument.

	* elf/dl-close (_dl_close): Free l_name and l_origin.

	* sysdeps/i386/useldt.h (THREAD_GETMEM, THREAD_SETMEM): Use P
	modifier in asm, not c.

	* sysdeps/mach/hurd/Makefile [subdirs==elf]: Define CFLAGS-dl-load.c
	to -DEXTERNAL_MAP_FROM_FD to make _dl_map_object_from_fd extern.

1998-08-26 17:48  Ulrich Drepper  <drepper@cygnus.com>

	* elf/dl-close.c (_dl_close): Move map->l_nsearchlist value into local
	variable so that map can be freed.
	Reported by Philippe Troin <phil@fifi.org>.

	* elf/dl-open.c (dl_open_worker): Correct test for extending global
	scope array.
	Patch by Philippe Troin <phil@fifi.org>.

1998-08-26  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/powerpc/register-dump.h: Rewrite.  Much nicer this way.
	Don't call writev() with a 100-element vector.
	* sysdeps/generic/segfault.c (catch_segfault): Skip top-level NULL
	return address.

	* sysdeps/powerpc/elf/libc-start.c: Sync up with generic version.
	In particular, set __libc_stack_end.
	* sysdeps/powerpc/elf/start.S: Allow _init and _fini to be
	undefined.  Fix copyright notice.

1998-08-25  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* math/Makefile (gmp-objs): New variable.
	($(objpfx)atest-exp, $(objpfx)atest-sincos, $(objpfx)atest-exp2):
	Depend on it.
	(tests): Add atest-exp atest-sincos atest-exp2.
	(tests-static): Remove atest-exp atest-sincos atest-exp2.

1998-08-25  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/generic/dl-cache.c: Move static variable cache and cachesize
	to toplevel.
	(_dl_unload_cache): New function.
	* elf/Versions [libc GLIBC_2.1]: Add _dl_unload_cache.
	* elf/dl-open.c (_dl_open): Unload map file before freeing the lock.
	* elf/rtld.c (dl_main): Unload map file before jumping to user code.

	* sysdeps/unix/sysv/linux/alpha/bits/fcntl.h: Define O_DIRECT.
	Correct comment for O_LARGEFILE.
	* sysdeps/unix/sysv/linux/bits/fcntl.h: Define O_DIRECT.
	Change O_LARGEFILE to correct value.

1998-08-25 14:34  Ulrich Drepper  <drepper@cygnus.com>

	* libio/iogetline.c (_IO_getline_info): Don't read anything for
	N == 0.  Patch by HJ Lu.

1998-08-25 11:43  Ulrich Drepper  <drepper@cygnus.com>

	* elf/elf.h: Add syminfo stuff and other DT_* from Solaris' ELF.

1998-08-25  Bernd Schmidt  <crux@Pool.Informatik.RWTH-Aachen.DE>

	* argp/argp.h: Use __inline__ not inline.

	* sysdeps/i386/bits/select.h (FD_ZERO): Rewrite asm not to indicate
	an input register as being clobbered.
	* sysdeps/i386/memset.c (memset): Likewise.
	* sysdeps/i386/bzero.c (__bzero): Likewise.
	* sysdeps/i386/memcopy.h ({BYTE,WORD}_COPY_[FB]WD): Likewise.

1998-08-25  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* stdlib/jrand48_r.c (__jrand48_r): Set also upper half of result.
	Fixes PR libc/757 (Reported by Michael Creutz <creutz@bnl.gov).

1998-08-24 16:34  Ulrich Drepper  <drepper@cygnus.com>

	* debug/catchsegv.sh: Handle text preceding backtrace better.
	* sysdeps/generic/segfault.c: Allow register dump.  Allow handler
	to be installed for other signals than SIGSEGV.
	* sysdeps/generic/register-dump.h: New file.
	* sysdeps/i386/register-dump.h: New file.
	* sysdeps/powerpc/register-dump.h: New file.

	* sysdeps/unix/sysv/linux/i386/profil-counter.h: Use macros from
	sigcontextinfo.h.
	* sysdeps/unix/sysv/linux/powerpc/profil-counter.h: Use i386 version.

1998-08-24  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/unix/sysv/linux/powerpc/sigcontextinfo.h: New file.

1998-08-09  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/unix/sysv/linux/powerpc/chown.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/lchown.S: New file.
	* sysdeps/unix/sysv/linux/powerpc/syscalls.list: Add chown, remove
	getresuid, getresgid.

1998-08-16  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/unix/sysv/linux/powerpc/clone.S: Fix bugs.  Set up stack
	pointer in userland.

1998-08-21  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/sysv/linux/sys/mount.h (MNT_FORCE): Define as enum
	and fix value.

1998-08-22  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/ldd.bash.in: Add missing quotes around $file.  Make loop
	over arguments Bourne shell compatible.  Don't exit unsuccessfully
	if nonelf returns successfully.  Avoid duplicating most of the
	script.
	* sysdeps/unix/sysv/linux/ldd-rewrite.sed: Add missing quotes
	around $file.

1998-08-24 10:37  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/sysv/linux/m68k/Makefile (sysdep_headers): Add
	sys/reg.h.
	* sysdeps/unix/sysv/linux/m68k/sys/reg.h: New file.
	* sysdeps/unix/sysv/linux/m68k/Dist: Distribute it.

1998-08-23  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/unix/sysv/linux/i386/Versions [GLIBC_2.1]: Add
	__modify_ldt and modify_ldt.
	* sysdeps/unix/sysv/linux/i386/syscalls.list: Add modify_ldt.

	* sysdeps/unix/sysv/linux/i386/sysdep.h (SYSCALL_ERROR_HANDLER):
	Use orl $-1 instead of movl $-1 to save two bytes.
	* sysdeps/unix/sysv/linux/i386/i686/sysdep.h (SYSCALL_ERROR_HANDLER):
	Likewise.

1998-08-17  H.J. Lu  <hjl@gnu.org>

	* libio/Versions (_IO_do_write, _IO_file_attach,
	_IO_file_close_it, _IO_file_finish, _IO_file_fopen,
	_IO_file_init, _IO_file_overflow, _IO_file_seekoff,
	_IO_file_setbuf, _IO_file_sync, _IO_file_underflow,
	_IO_file_write, _IO_file_xsputn): Added to GLIBC_2.1.

	* libio/fileops.c (_IO_do_write, _IO_file_attach,
	_IO_file_close_it, _IO_file_finish, _IO_file_fopen,
	_IO_file_init, _IO_file_overflow, _IO_file_seekoff,
	_IO_file_setbuf, _IO_file_sync, _IO_file_underflow,
	_IO_file_write, _IO_file_xsputn): Change the prefix to
	"_IO_new_". Added to GLIBC_2.1.

	* libio/libioP.h (_IO_do_write, _IO_file_attach,
	_IO_file_close_it, _IO_file_finish, _IO_file_fopen,
	_IO_file_init, _IO_file_overflow, _IO_file_seekoff,
	_IO_file_setbuf, _IO_file_sync, _IO_file_underflow,
	_IO_file_write, _IO_file_xsputn): Add prototypes for the prefix
	"_IO_new_".

	* libio/oldfileops.c (_IO_do_write, _IO_file_attach,
	_IO_file_close_it, _IO_file_finish, _IO_file_fopen,
	_IO_file_init, _IO_file_overflow, _IO_file_seekoff,
	_IO_file_setbuf, _IO_file_sync, _IO_file_underflow,
	_IO_file_write, _IO_file_xsputn): Added to GLIBC_2.0.

1998-08-23  Richard Henderson  <rth@cygnus.com>

	* Makeconfig (LDFLAGS): Remove.

	* csu/initfini.c: Return to .text before __gmon_start__.

	* elf/elf.h (EM_FAKE_ALPHA): Rename from EM_OLD_ALPHA.
	(STO_MIPS_*): Rename from STO_*.
	(STB_MIPS_SPLIT_COMMON): Rename from STB_SPLIT_COMMON.
	(STO_ALPHA_NOPV, STO_ALPHA_STD_GPLOAD): New.

	* math/atest-exp.c (mpn_bitsize): Fix bit location calculation.
	(main): e3s is negative on zero.
	* math/atest-exp2.c: Likewise.
	* math/atest-sincos.c: Likewise.

1998-08-23  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* Makerules (install): Add comment about absolute paths.

1998-08-23  Ulrich Drepper  <drepper@cygnus.com>

	* libio/vsnprintf.c (_IO_vsnprintf): Set first byte of destination
	array to NUL to handle maxlen==1 case correctly.
	Patch by HJ Lu.

1998-08-23  Richard Henderson  <rth@cygnus.com>

	* sysdeps/alpha/elf/crtbegin.S: Fix .prologue; no pv used.
	* sysdeps/alpha/elf/crtend.S: Likewise.
	* sysdeps/alpha/elf/start.S: Likewise.

	* sysdeps/unix/sysv/linux/alpha/rt_sigaction.S: Fix .prologue;
	non-standard pv usage.

	* sysdeps/unix/sysv/linux/alpha/brk.S: Use jmp macro for relaxation.
	* sysdeps/unix/sysv/linux/alpha/getitimer.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/getrusage.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/gettimeofday.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/select.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/setitimer.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/settimeofday.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/utimes.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/wait4.S: Likewise.

	* sysdeps/alpha/fpu/e_sqrt.c: Use the asm version when the input is
	a finite non-denormal, deferring to the full IEEE version otherwise.

	* sysdeps/alpha/fpu/bits/mathinline.h (__floorf, __floor):
	Early out for -0.  Optimize for !_IEEE_FP_INEXACT.
	* sysdeps/alpha/fpu/s_floor.c: New.
	* sysdeps/alpha/fpu/s_floorf.c: New.
	* sysdeps/alpha/fpu/s_ceil.c: New.
	* sysdeps/alpha/fpu/s_ceilf.c: New.

1998-08-22  Philip Blundell  <philb@gnu.org>

	* sysdeps/arm/bits/string.h: New file.

1998-08-12  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* sysdeps/unix/sysv/linux/configure.in: Obey --with-headers,
	document it.

	* sysdeps/unix/sysv/linux/alpha/configure.in: New file, contains
	test for recent Linux 2.1.100+ headers.

1998-08-21  Thorsten Kukuk  <kukuk@vt.uni-paderborn.de>

	* nis/nss_compat/compat-initgroups.c: Optimize NIS query.

1998-08-21 17:21  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/unix/sysv/linux/glob64.c: Define __stat using __xstat64.

1998-08-20  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makefile (elf/ldso_install): Put back.  The problem still persists.
	* elf/Makefile (ldso_install): Likewise.

1998-08-20  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* db2/db/db.c (db_open) [_LIBC]: Rename to __nss_db_open and
	create weak alias.
	* include/db.h: Declare __nss_db_open.
	* db2/Versions: Export it.

	* db2/makedb.c: Convert to use db2 API.
	* nss/nss_db/db-XXX.c: Likewise.
	* nss/nss_db/db-netgrp.c: Likewise.
	* nss/nss_db/db-alias.c: Likewise.
	(_nss_db_getaliasent_r): Allow retrying with a larger buffer.

1998-08-19  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* sysdeps/unix/sysv/linux/Makefile (sysdep_routines): Remove
	sys_setresuid, already built automatically (or not).
	* sysdeps/unix/sysv/linux/syscalls.list: Define __setresuid
	instead of __syscall_setresuid and add back setresuid.
	* sysdeps/unix/sysv/linux/seteuid.c: Use __setresuid instead of
	__syscall_setresuid.

1998-08-21  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* sysdeps/unix/sysv/linux/sys/mount.h: Fix typo.

1998-08-20  Ulrich Drepper  <drepper@cygnus.com>

	* elf/Makefile (sh-ldd-rewrite): Remove expression to remove
	BASH-ONLY marked region.
	* elf/ldd.bash.in: Remove special BASH-ONLY markers.

1998-02-20 17:54  H.J. Lu  <hjl@gnu.org>

	* libio/oldfileops.c (_IO_file_seekoff): Don't adjust pointers if
	_IO_SYSSEEK fails.

	* libio/iolibio.h (_IO_pos_BAD): Define of type _IO_fpos64_t.

	* libio/libioP.h (FILEBUF_LITERAL): Also initialize new _offset
	element.

1998-08-21  Roland McGrath  <roland@baalperazim.frob.com>

	* elf/ldd.bash.in (TEXTDOMAIN, TEXTDOMAINDIR): Surround setting these
	with magic comments ###BASH-ONLY and ###END-BASH-ONLY.
	* elf/Makefile ($(objpfx)ldd): Generate always from ldd.bash.in.
	(common-ldd-rewrite): New variable, old contents of $(sh-ldd-rewrite).
	(sh-ldd-rewrite): Use that, add cmds to remove code surrounded by
	those magic comments, and to use /bin/sh for @BASH@.
	(bash-ldd-rewrite): Use $(common-ldd-rewrite).
	* elf/ldd.sh.in: File removed.

1998-08-20 20:07  Ulrich Drepper  <drepper@cygnus.com>

	* pwd/getpw.c (__getpw): Use %lu for uid and gid parameter and
	cast them to unsigned long int.
	* pwd/putpwent.c (putpwent): Likewise.
	Patch by John Tobey <jtobey@banta-im.com>.

1998-08-20 17:14  H.J. Lu  <hjl@gnu.org>

	* libio/libioP.h (FILEBUF_LITERAL): Set the _offset field to
	_IO_pos_BAD.

1998-02-20 17:54  H.J. Lu  <hjl@gnu.org>

	* libio/fileops.c (_IO_file_seekoff): Don't adjust pointers if
	_IO_SYSSEEK fails.

1998-08-20 19:14  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/unix/sysv/linux/Makefile [subdirs=misc] (sysdeps_routines):
	Add umount and umount2.
	* sysdeps/unix/sysv/linux/syscalls.list: Remove umount.
	* sysdeps/unix/sysv/linux/umount.S: New file.
	* sysdeps/unix/sysv/linux/umount2.S: New file.
	* sysdeps/unix/sysv/linux/sys/mount.h: Declare umount2.
	Define MNT_FORCE.

	* sysdeps/unix/sysv/linux/Makefile [subdirs=misc] (sysdep_headers):
	Add sys/sendfile.h.
	* sysdeps/unix/sysv/linux/syscalls.list: Add sendfile.
	* sysdeps/unix/sysv/linux/sys/sendfile.h: New file.

	* sysdeps/unix/sysv/linux/sys/acct.h: Pretty print.

	* sysdeps/unix/sysv/linux/Versions [GLIBC_2.1]: Add umount2 and
	sendfile.

1998-08-20 16:01  Ulrich Drepper  <drepper@cygnus.com>

	* elf/ldd.sh.in: Redirect warnings and error messages to stderr.
	* elf/ldd.bash.in: Likewise.

	* elf/sln.c: Avoid warning for no main prototype.

	* sysdeps/unix/sysv/linux/alpha/bits/fcntl.h: Remove O_READ and
	O_WRITE.
	* sysdeps/unix/sysv/linux/mips/bits/fcntl.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/fcntl.h: Likewise.

	* sysdeps/unix/sysv/linux/alpha/bits/fcntl.h: Add F_SETSIG and
	F_GETSIG.
	* sysdeps/unix/sysv/linux/bits/fcntl.h: Likewise.
	* sysdeps/unix/sysv/linux/mips/bits/fcntl.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/fcntl.h: Likewise.

1998-08-20  Philip Blundell  <pb@nexus.co.uk>

	* sysdeps/arm/fpu/ieee754.h: Move to...
	* sysdeps/arm/ieee754.h: ... here.

	* sysdeps/arm/__longjmp.S: Put return value in correct register.
	Don't set the condition flags unnecessarily.
	* sysdeps/arm/fpu/__longjmp.S: Likewise.  Restore floating point
	registers correctly.

	* sysdeps/arm/dl-machine.h: Fix problems with profiling code
	(patch from Scott Bambrough).

	* sysdeps/arm/sysdep.h (CALL_MCOUNT): Add missing semicolons.

	* csu/initfini.c (_init): Don't check whether __gmon_start__ is
	NULL, just call it unconditionally.
	(__gmon_start__): Provide stub version as a weak symbol.

1998-07-30  Philip Blundell  <philb@gnu.org>

	* sysdeps/unix/sysv/linux/arm/init-first.h: New file (from patch
	by Scott Bambrough)

	* sysdeps/unix/sysv/linux/arm/errlist.c: New file; ARM tools don't
	like `@' in .type directives.

	* sysdeps/arm/bsd-setjmp.S: Use PLT for procedure call.
	* sysdeps/arm/bsd-_setjmp.S: Likewise.

	* sysdeps/arm/dl-machine.h: Set __libc_stack_end.

1998-08-20  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* sysdeps/unix/sysv/linux/mips/bits/fcntl.h (F_SETOWN): Correct value.
	(F_GETOWN): Likewise.

	* sysdeps/unix/sysv/linux/bits/siginfo.h (SI_SIGIO): Add it (from
	Linux 2.1.117).

1998-08-20  Ulrich Drepper  <drepper@cygnus.com>

	* sysdeps/generic/glob.c [_LIBC]: Define __stat only if not
	already defined.

1998-08-18  Ulrich Drepper  <drepper@cygnus.com>

	* include/features.h: Define __USE_EXTERN_INLINES for recent
	enough gcc.
	* argp/argp.h: Define extern inline functions only if
	__USE_EXTERN_INLINES is defined.
	* libio/stdio.h: Likewise.
	* math/math.h: Likewise.
	* stdlib/stdlib.h: Likewise.
	* string/argz.h: Likewise.
	* sysdeps/generic/bits/sigset.h: Likewise.
	* sysdeps/unix/sysv/linux/bits/sigset.h: Likewise.
	* sysdeps/unix/sysv/sysv4/bits/sigset.h: Likewise.
	* sysdeps/wordsize-32/inttypes.h: Likewise.
	* sysdeps/wordsize-64/inttypes.h: Likewise.
	* wcsmbs/wchar.h: Likewise.

	* sysdeps/generic/bits/glob.c [_LIBC]: Define __stat using __xstat
	to allow compilation without optimization.

1998-08-14  Thorsten Kukuk  <kukuk@vt.uni-paderborn.de>

	* nis/nss_compat/compat-grp.c: Set errno to ENOENT if we have no
	more entries.
	* nis/nss_compat/compat-initgroups.c: Likewise.
	* nis/nss_compat/compat-pwd.c: Likewise.
	* nis/nss_compat/compat-spwd.c: Likewise.
	* nis/nss_nis/nis-alias.c: Likewise.
	* nis/nss_nis/nis-ethers.c: Likewise.
	* nis/nss_nis/nis-grp.c: Likewise.
	* nis/nss_nis/nis-hosts.c: Likewise.
	* nis/nss_nis/nis-initgroups.c: Likewise.
	* nis/nss_nis/nis-network.c: Likewise.
	* nis/nss_nis/nis-proto.c: Likewise.
	* nis/nss_nis/nis-pwd.c: Likewise.
	* nis/nss_nis/nis-rpc.c: Likewise.
	* nis/nss_nis/nis-service.c: Likewise.
	* nis/nss_nis/nis-spwd.c: Likewise.

	* nis/rpcsvc/yp.h: Generate new without 1024 byte limits.

	* nis/ypclnt.c: Try binding dir only first time, could be to old.

	* nis/yp_xdr.c: Remove 1024 byte limit.
	* nis/ypupdate_xdr.c: Likewise.

	* nis/nss_nis/nis-publickey.c: Make sure, nobody could send
	wrong data.

1998-08-18  Roland McGrath  <roland@baalperazim.frob.com>

	* Rules (binaries-static, binaries-shared static pattern rules):
	Depend on lib%, not just libc%, from $(link-libc{,-static}).

	* sysdeps/mach/hurd/Makefile (link-libc-static): New variable; set
	this here, overriding Makeconfig generic value so we link against
	the RPC libs.

1998-08-17  Ulrich Drepper  <drepper@cygnus.com>

	* posix/tstgetopt.c (options): Add NULL entry at end
	Patch by Adrian Miranda <ade@psg.com>.

1998-08-15 18:21  Ulrich Drepper  <drepper@cygnus.com>

	* elf/elf.h: Add EI_OSABI, ELFOSABI*, and EI_ABIVERSION.  Move EI_PAD
	to 9.

1998-08-15 14:11  Ulrich Drepper  <drepper@cygnus.com>

	* elf/elf.h: Add PPC Diab relocations.

	* malloc/Makefile (libmcheck.a): Use $(LN_S) not ln.

1998-08-14 10:08  Ulrich Drepper  <drepper@cygnus.com>

	* manual/texinfo.tex: Update.

1998-08-07  Geoff Keating  <geoffk@ozemail.com.au>

	* sysdeps/powerpc/backtrace.c: New file.

1998-08-14  Philip Blundell  <pb@nexus.co.uk>

	* sysdeps/arm/fpu/setjmp.S: Correct value of R0 before calling
	sigjmp_save.
	* sysdeps/arm/elf/setjmp.S: Obsolete, deleted.

1998-08-11  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makefile (install-symbolic-link): Fix spelling.

1998-08-11  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* elf/elf.h (SHT_HIOS): Fix value.

1998-08-10  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* posix/regex.c (WIDE_CHAR_SUPPORT): Don't generate defined as
	part of the expansion, this is undefined by the standard.

1998-08-13 19:41  Ulrich Drepper  <drepper@cygnus.com>

	* posix/getconf.c: Add support for systems with incomplete confname.h.

	* sysdeps/posix/sigset.c: Allow SIG_HOLD being undefined.

	* sysdeps/posix/wait3.c: Make it work.

1998-08-13  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* Makefile ($(inst_slibdir)/libc-$(version).so): Remove.
	(elf/ldso_install): Remove.

	* elf/Makefile (distribute): Add sln.c.
	(others): Add sln.
	(others-static): Add sln.
	(install-rootsbin): Add sln.
	(others-static): Add sln.
	(ldso_install): Remove.

1998-07-24 10:58  Andreas Schwab  <schwab@issan.informatik.uni-dortmund.de>

	* Makerules (install-clean-symbolic-link-list): Make phony.
	* Makefile (install-symbolic-link): Make phony.  Depend on
	subdir_install for parallel makes.


1998-07-22  Ulrich Drepper  <drepper@cygnus.com>

	* elf/Makefile (distribute): Add sln.c

1998-07-21 07:10  H.J. Lu  <hjl@gnu.org>

	* elf/sln.c: New file.

	* Makerules (symbolic-link-prog, symbolic-link-list): New macros.
	(install-clean-symbolic-link-list): New target.
	(install): Depend on install-clean-symbolic-link-list.
	(make-shlib-link): Changed for $(symbolic-link-list).

	* Makefile (install-symbolic-link): New target.
	(install): Depend on install-symbolic-link.

1998-08-12 17:03  Ulrich Drepper  <drepper@cygnus.com>

	* include/unistd.h: Protect against multiple inclusion.

	* posix/glob.c: Don't define __glob_pattern_p is NO_GLOB_PATTERN_P
	is defined, not is glob is defined.
	* sysdeps/unix/sysv/linux/glob64.c: Define NO_GLOB_PATTERN_P.

1998-08-01 17:18  H.J. Lu  <hjl@gnu.org>

	* sunrpc/rpcsvc/rusers.x (xdr_utmp): Use xdr_bytes instead of
	xdr_string for ut_line, ut_name and ut_host.

1998-08-12  Andreas Jaeger  <aj@arthur.rhein-neckar.de>

	* sysdeps/unix/sysv/linux/paths.h (_PATH_MAILDIR): Change to
	/var/mail in accordance with FHS 2.0.
	Reported by Javier Kohen <root@jkohen.tough.com.ar> [PR libc/639].

1998-08-12  Richard Henderson  <rth@cygnus.com>

	* sysdeps/unix/sysv/linux/alpha/syscalls.list (recvmsg, sendmsg):
	Update aliases for cancelation.

	* sysdeps/unix/sysv/linux/alpha/glob.c: Undef glob*64 before
	playing with symbol versions.

1998-08-12  Roland McGrath  <roland@baalperazim.frob.com>

	* sysdeps/mach/hurd/bits/posix_opt.h: Rewritten with comments and
	multiple inclusion protection.
	(_POSIX_SYNCHRONIZED_IO, _POSIX_FSYNC, _POSIX_MAPPED_FILES,
	_POSIX_MEMORY_PROTECTION, _POSIX_POLL, _POSIX_SELECT): New macros,
	define all these to 1.
	(_POSIX_SYNC_IO): Add #undef, to remind us that pathconf reports it.

1998-08-12  Roland McGrath  <roland@baalperazim.frob.com>

	* sysdeps/mach/usleep.c: Include <unistd.h>.
	(usleep): Return void.

1998-08-11  Roland McGrath  <roland@baalperazim.frob.com>

	* sysdeps/generic/if_index.c (struct if_freenameindex): Add forward
	decl to inhibit warning in if_freenameindex defn.

	* sysdeps/mach/hurd/ttyname_r.c (__ttyname_r): Remove unused variable.

	* sysdeps/mach/hurd/getdomain.c (getdomainname): Renamed from __ name.

	* sysdeps/mach/hurd/reboot.c: Include <sys/reboot.h>.
	* sysdeps/mach/hurd/getdents.c: Include <unistd.h>.
	* sysdeps/mach/hurd/sbrk.c: Include <unistd.h>.
	* sysdeps/mach/usleep.c: Likewise.

	* sysdeps/mach/hurd/bind.c (bind): Add a const.

	* sysdeps/mach/hurd/getdents.c (__getdirentries): Use prototype defn.
	* sysdeps/unix/bsd/init-posix.c (__init_posix): Likewise.
	* sysdeps/unix/bsd/times.c (timeval_to_clock_t): Likewise.
	* sysdeps/mach/hurd/reboot.c (reboot): Likewise.
	* sysdeps/mach/usleep.c (usleep): Likewise.
	* sysdeps/mach/hurd/chflags.c (chflags): Likewise.
	* sysdeps/mach/hurd/fchflags.c (fchflags): Likewise.
	* sysdeps/mach/hurd/sbrk.c (__sbrk): Likewise.
	* sysdeps/mach/hurd/stdio_init.c (__stdio_init_stream): Likewise.

1998-08-11  Roland McGrath  <roland@baalperazim.frob.com>

	* sysdeps/generic/glob64.c: Include <sys/types.h>, <glob.h>, <errno.h>.
	(glob64): Fix typo.

	* malloc/malloc.c (free_check, realloc_check): Don't cast to long for
	%p arg to fprintf, since `void *' is the right type already.

1998-07-25 19:47  Jose M. Moya  <josem@gnu.org>

	* sysdeps/mach/hurd/getcwd.c
	(_hurd_canonicalize_directory_name_internal): Do not loop forever
	for unknown root directories.
	(__getcwd): Return NULL when the current root directory could not
	be reached.

1998-08-11 18:39  Ulrich Drepper  <drepper@cygnus.com>

	* string/strsignal.c (strsignal): Count real-time signals from zero.


See ChangeLog.8 for earlier changes.
